# üß™ Pollab ‚Äî Backend

**About Pollab**

**Pollab** (short for Poll Laboratory) is a modern, open-source polling platform designed to 
simplify the way users gather opinions and make decisions. Built with a **Django REST API** 
and **PostgreSQL**, it can be consumed by a _frontend_ and _mobile_ solution. Pollab features:
- üß† A clean and responsive UI 
- ‚öôÔ∏è Reactive Forms with validation
- üïí Real-time vote tracking and countdown timers
- üì¢ Toast notifications for a smooth UX

Whether you're testing ideas, collecting feedback, or showcasing interactive demos ‚Äî Pollab lets you create, vote, and visualize results in seconds.
> **Join. Experiment. Transform.**

[//]: # (## Interface)

[//]: # ()
[//]: # (<p align="center">)

[//]: # (  <img src="readme_assets/mobile_create.png" alt="Splashscreen" width="30%"/>)

[//]: # (  <img src="readme_assets/mobile_polllist.png" alt="Enquetes Abertas" width="30%"/>)

[//]: # (  <img src="readme_assets/mobile_polldetails.png" alt="Detalhe da Enquete" width="30%"/>)

[//]: # (</p>)

---

## ‚ú® Vis√£o Geral

| Item              | Detalhe                                                                                 |
|-------------------|-----------------------------------------------------------------------------------------|
| **Stack**         | Python ¬∑ Django ¬∑ DRF ¬∑ PostgreSQL                                                      |
| **Idenfitica√ß√£o** | O usu√°rio/participante √© identificado por um `id_participante` na requisi√ß√£o de voto.   |
| **Objetivo**      | CRUD de enquetes, preven√ß√£o de voto duplicado e listagem de resultados.                 |
| **Documenta√ß√£o**  | Gera√ß√£o autom√°tica de documenta√ß√£o da API com `drf-spectacular` (Swagger/ReDoc).        |


---

## ‚öôÔ∏è Setup

0. **Prerequisites**

Before getting started, make sure the following tools are installed on your system:

- [Python ‚â• 3.9](https://www.python.org/downloads/) (added to `PATH`)
- [PostgreSQL](https://www.postgresql.org/download/) (default user: `postgres`, password: `postgres`)
- [Git](https://git-scm.com/)
- [PyCharm Community](https://www.jetbrains.com/pycharm/download)

1. **Clone the repository in PyCharm**
    - Open PyCharm
    - Go to `File > New > Project from Version Control`.
    - Use the repository URL: https://github.com/igormahall/pollab-backend.git
    - Choose a local folder and click **Clone**.

2. **Create the virtual environment**
    ```bash
    .venv\Scripts\activate       # Windows
    # source .venv/bin/activate  # macOS / Linux
    ```

3. **Install the dependencies**
    ```bash
    pip install --upgrade pip
    pip install -r requirements.txt
    ```

4. **Create the `.env` file**
    - Create a new file called .env in the project root with the following content:
    ```env
    DJANGO_SECRET_KEY=your-secret-key-here
    ```
    - To generate a secure secret key:
    ```bash
    python -c "from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())"
    ```

5. **Create the PostgreSQL database**
    ```bash
    psql -U postgres
    ```
    - When prompted, enter the password: `postgres`
    - Inside the PostgreSQL shell:
    ```sql
    CREATE DATABASE enquete;
    \q
    ```

6. **Run the migrations**
    ```bash
    python manage.py makemigrations
    python manage.py migrate
    python manage.py createsuperuser
    ```

7. **Create a superuser**
    ```bash
    python manage.py createsuperuser
    ```
    - Follow the prompts to define username, email, and password.


8. **Start the development server**
    ```bash
    python manage.py runserver
    ```
    - Access the admin panel at: **http://127.0.0.1:8000/**.
    - API interative documentation at: **/api/swagger/**.

### Important
- Never commit your real `.env` file to version control!
- Ensure `.env` is listed in `.gitignore`.

---

## üóÑÔ∏è Modelo de Dados

A l√≥gica do sistema √© sustentada por tr√™s modelos principais.

### 1. Enquete

| Campo          | Tipo                | Descri√ß√£o                                                   |
|----------------|---------------------|-------------------------------------------------------------|
| `id`           | `BigAutoField` (PK) | Identificador √∫nico                                         |
| `titulo`       | `CharField`         | Pergunta exibida ao usu√°rio                                 |
| `data_criacao` | `DateTimeField`     | Timestamp de cria√ß√£o                                        |
| `status`       | `CharField`         | Estado atual (`Aberta` ou `Fechada`), selecion√°vel no Admin |


---

### 2. Opcao

| Campo         | Tipo                            | Descri√ß√£o                      |
|---------------|---------------------------------|--------------------------------|
| `id`          | `BigAutoField` (PK)             | Identificador √∫nico            |
| `enquete`     | `ForeignKey('Enquete')`         | Enquete associada              |
| `texto_opcao` | `CharField`                     | Texto exibido no bot√£o de voto |
| `votos`       | `IntegerField`                  | Contador de votos              |

---

### 3. Voto

| Campo             | Tipo                    | Descri√ß√£o                           |
|-------------------|-------------------------|-------------------------------------|
| `id`              | `BigAutoField` (PK)     | Identificador                       |
| `id_participante` | `CharField`             | Identificador √∫nico do participante |
| `enquete`         | `ForeignKey('Enquete')` | Enquete votada                      |
| `opcao_escolhida` | `ForeignKey('Opcao')`   | Op√ß√£o votada                        |
| `data_voto`       | `DateTimeField`         | Timestamp do voto                   |

**Restri√ß√£o de unicidade**

```python
class Meta:
    unique_together = ("enquete", "id_participante")
```
Garante **1¬†voto por participante** em cada enquete.

---

### üîó Relacionamentos & Fluxo

```
Poll 1 ‚îÄ‚îÄ< Choice 1 ‚îÄ‚îÄ< Vote
           ^                 |
           |-----------------|
```

1. **Uma** `Enquete` possui **v√°rias** `Op√ß√µes`.  
2. Ao votar, cria‚Äëse um objeto `Voto` apontando para a op√ß√£o escolhida.  
3. Caso a restri√ß√£o de unicidade dispare, retorna 409¬†Conflict.  
4. Ap√≥s salvar o voto, o campo `votos` da op√ß√£o √© incrementado de forma at√¥mica.

---

## üîå Endpoints REST

| Verbo + Rota                     | A√ß√£o     | Descri√ß√£o                                                          |
|----------------------------------|----------|--------------------------------------------------------------------|
| `GET /api/enquetes/`             | Listar   | Retorna *todas* as enquetes, abertas e fechadas.                   |
| `GET /api/enquetes/{id}/`        | Detalhar | Retorna os dados de uma enquete espec√≠fica, incluindo suas op√ß√µes. |
| `POST /api/enquetes/`            | Criar    | Cria uma nova enquete e suas op√ß√µes aninhadas.                     |
| `POST /api/enquetes/{id}/votar/` | Votar    | Registra um voto para um participante em uma op√ß√£o espec√≠fica.     |

> Todas as respostas seguem o padr√£o `application/json` com camelCase no payload.

Exemplo ‚Äî **POST /api/enquetes/1/votar/**
```json
{
  "id_opcao": 2,
  "id_participante": "carlinhos_teste_123"
}
```

Poss√≠veis respostas:

| C√≥digo              | Significado                               |
|---------------------|-------------------------------------------|
| **200** OK          | Voto computado com sucesso.               |
| **400** Bad Request | A op√ß√£o enviada n√£o pertence √† enquete.   |
| **409** Conflict    | Este participante j√° votou nesta enquete. |

---

## üöÄ Deploy

O projeto est√° configurado para deploy em plataformas modernas como Render ou Heroku. 
As configura√ß√µes de produ√ß√£o (como `DEBUG`, `ALLOWED_HOSTS` e `DATABASE_URL`) s√£o lidas
a partir de vari√°veis de ambiente para garantir a seguran√ßa.

---

## ü§ù Contribuindo

Contribui√ß√µes s√£o bem-vindas! Se voc√™ quiser sugerir melhorias, relatar bugs ou propor 
novas funcionalidades, sinta-se √† vontade para abrir uma issue ou pull request.

---

## üìú Licen√ßa

Distribu√≠do sob a licen√ßa **MIT**.
