# üìä API Django ‚Äî Sistema de Enquetes

Backend **RESTful** para gerenciar enquetes de m√∫ltipla escolha.  
Constru√≠do com **Django¬†5** + **Django REST Framework** e banco **PostgreSQL** 
e e oferece uma documenta√ß√£o interativa via Swagger.

---

## ‚ú® Vis√£o Geral

| Item              | Detalhe                                                                                 |
|-------------------|-----------------------------------------------------------------------------------------|
| **Stack**         | Python ¬∑ Django ¬∑ DRF ¬∑ PostgreSQL                                                      |
| **Idenfitica√ß√£o** | O usu√°rio/participante √© identificado por um `id_participante` na requisi√ß√£o de voto.   |
| **Objetivo**      | CRUD de enquetes, preven√ß√£o de voto duplicado e listagem de resultados.                 |
| **Documenta√ß√£o**  | Gera√ß√£o autom√°tica de documenta√ß√£o da API com `drf-spectacular` (Swagger/ReDoc).        |


---

## ‚öôÔ∏è Configura√ß√£o R√°pida (Dev)

```bash
# 1. Clone o reposit√≥rio e entre na pasta
git clone https://github.com/<seu-usuario>/enquete-api.git
cd enquete-api

# 2. Crie e ative o ambiente virtual
python -m venv .venv
.venv\Scripts\activate       # Windows
# source .venv/bin/activate  # macOS / Linux

# 3. Instale as depend√™ncias
pip install -r requirements.txt

# 4. Configure as vari√°veis de ambiente
# Copie o arquivo de exemplo. No Windows, use 'copy' em vez de 'cp'.
cp .env.example .env

# AGORA, ABRA O ARQUIVO '.env' E EDITE-O com sua SECRET_KEY e a URL do seu banco de dados.
# Um comando para gerar uma nova SECRET_KEY est√° comentado dentro do arquivo .env.example.

# 5. Execute as migra√ß√µes e crie um superusu√°rio
python manage.py migrate
python manage.py createsuperuser

# 6. Execute o servidor de desenvolvimento
python manage.py runserver
```

A API sobe em **http://127.0.0.1:8000/**.

A documenta√ß√£o interativa da API estar√° em **/api/swagger/**.

---

## üóÑÔ∏è Modelo de Dados

A l√≥gica do sistema √© sustentada por tr√™s modelos principais.

### 1. Enquete

| Campo          | Tipo                | Descri√ß√£o                                                   |
|----------------|---------------------|-------------------------------------------------------------|
| `id`           | `BigAutoField` (PK) | Identificador √∫nico                                         |
| `titulo`       | `CharField`         | Pergunta exibida ao usu√°rio                                 |
| `data_criacao` | `DateTimeField`     | Timestamp de cria√ß√£o                                        |
| `status`       | `CharField`         | Estado atual (`Aberta` ou `Fechada`), selecion√°vel no Admin |


---

### 2. Opcao

| Campo         | Tipo                            | Descri√ß√£o                      |
|---------------|---------------------------------|--------------------------------|
| `id`          | `BigAutoField` (PK)             | Identificador √∫nico            |
| `enquete`     | `ForeignKey('Enquete')`         | Enquete associada              |
| `texto_opcao` | `CharField`                     | Texto exibido no bot√£o de voto |
| `votos`       | `IntegerField`                  | Contador de votos              |

---

### 3. Voto

| Campo             | Tipo                    | Descri√ß√£o                           |
|-------------------|-------------------------|-------------------------------------|
| `id`              | `BigAutoField` (PK)     | Identificador                       |
| `id_participante` | `CharField`             | Identificador √∫nico do participante |
| `enquete`         | `ForeignKey('Enquete')` | Enquete votada                      |
| `opcao_escolhida` | `ForeignKey('Opcao')`   | Op√ß√£o votada                        |
| `data_voto`       | `DateTimeField`         | Timestamp do voto                   |

**Restri√ß√£o de unicidade**

```python
class Meta:
    unique_together = ("enquete", "id_participante")
```
Garante **1¬†voto por participante** em cada enquete.

---

### üîó Relacionamentos & Fluxo

```
Poll 1 ‚îÄ‚îÄ< Choice 1 ‚îÄ‚îÄ< Vote
           ^                 |
           |-----------------|
```

1. **Uma** `Enquete` possui **v√°rias** `Op√ß√µes`.  
2. Ao votar, cria‚Äëse um objeto `Voto` apontando para a op√ß√£o escolhida.  
3. Caso a restri√ß√£o de unicidade dispare, retorna 409¬†Conflict.  
4. Ap√≥s salvar o voto, o campo `votos` da op√ß√£o √© incrementado de forma at√¥mica.

---

## üîå Endpoints REST

| Verbo + Rota                     | A√ß√£o     | Descri√ß√£o                                                          |
|----------------------------------|----------|--------------------------------------------------------------------|
| `GET /api/enquetes/`             | Listar   | Retorna *todas* as enquetes, abertas e fechadas.                   |
| `GET /api/enquetes/{id}/`        | Detalhar | Retorna os dados de uma enquete espec√≠fica, incluindo suas op√ß√µes. |
| `POST /api/enquetes/`            | Criar    | Cria uma nova enquete e suas op√ß√µes aninhadas.                     |
| `POST /api/enquetes/{id}/votar/` | Votar    | Registra um voto para um participante em uma op√ß√£o espec√≠fica.     |

> Todas as respostas seguem o padr√£o `application/json` com camelCase no payload.

Exemplo ‚Äî **POST /api/enquetes/1/votar/**
```json
{
  "id_opcao": 2,
  "id_participante": "carlinhos_teste_123"
}
```

Poss√≠veis respostas:

| C√≥digo              | Significado                               |
|---------------------|-------------------------------------------|
| **200** OK          | Voto computado com sucesso.               |
| **400** Bad Request | A op√ß√£o enviada n√£o pertence √† enquete.   |
| **409** Conflict    | Este participante j√° votou nesta enquete. |

---

## üöÄ Deploy

O projeto est√° configurado para deploy em plataformas modernas como Render ou Heroku. 
As configura√ß√µes de produ√ß√£o (como `DEBUG`, `ALLOWED_HOSTS` e `DATABASE_URL`) s√£o lidas
a partir de vari√°veis de ambiente para garantir a seguran√ßa.

---

## ü§ù Contribuindo

Contribui√ß√µes s√£o bem-vindas! Se voc√™ quiser sugerir melhorias, relatar bugs ou propor 
novas funcionalidades, sinta-se √† vontade para abrir uma issue ou pull request.

---

## üìú Licen√ßa

Distribu√≠do sob a licen√ßa **MIT**.
